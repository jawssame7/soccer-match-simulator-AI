# サッカー試合シミュレーター (soccer-match-simulator) 仕様書

## 1. 概要

実在するヨーロッパトップリーグ（プレミアリーグ、ラ・リーガ、セリエA、ブンデスリーガ）の選手を使用して、AIによるサッカー試合のシミュレーションを行うWebアプリケーション。

## 2. 技術スタック

### 2.1 フロントエンド
- **フレームワーク**: React + TypeScript
- **ホスティング**: AWS CloudFront + S3

### 2.2 バックエンド
- **言語**: TypeScript (Node.js)
- **API**: AWS Lambda + API Gateway
- **AI**: Gemini API

### 2.3 デプロイ環境
- AWS (CloudFront, S3, Lambda, API Gateway)

## 3. 機能要件

### 3.1 入力機能

#### 3.1.1 自チーム情報入力
- **チーム名**: テキスト入力
- **監督名**: テキスト入力
- **フォーメーション**: テキスト入力（例: 4-3-3, 4-4-2, 3-5-2）
- **メンバーリスト**: 名前とポジションのリスト形式
  - GK: 1名
  - DF: フォーメーションに応じた人数
  - MF: フォーメーションに応じた人数
  - FW: フォーメーションに応じた人数

#### 3.1.2 対戦相手情報入力
- 自チームと同様の入力項目

#### 3.1.3 選手について
- **対象リーグ**: プレミアリーグ、ラ・リーガ、セリエA、ブンデスリーガ
- **能力値**: 実在選手の特徴・能力をAIが判断（入力不要）
- **入力形式**: 選手名のみ（ポジションと組み合わせて入力）

### 3.2 試合シミュレーション機能

#### 3.2.1 ランダム要素
- **天候**: AIが試合ごとにランダムに決定（晴れ、曇り、雨、強風など）
- **気温**: AIが試合への影響を考慮して決定
- **ピッチ状態**: AIが天候等を考慮して決定（良好、やや重い、重いなど）
- **試合展開**: 同じチーム構成でも毎回異なる結果
- **備考**: すべての環境条件はAIが自然な組み合わせで決定

#### 3.2.2 AI処理
- Gemini APIを使用して試合をシミュレート
- 選手の実際の能力・特徴を考慮
- **監督の戦術スタイル・特徴を反映**
  - 監督の戦術哲学（ポゼッション重視、カウンター重視など）
  - プレススタイル（ハイプレス、ミドルブロックなど）
  - 攻撃パターン（サイド攻撃、中央突破など）
  - 選手起用の特徴
- **今季（2024-25シーズン）の各リーグトレンドを考慮**
  - プレミアリーグ: 現在の戦術トレンド、主流フォーメーション
  - ラ・リーガ: 技術的なスタイル、ポゼッション重視の傾向
  - セリエA: 守備的な組織、戦術的な柔軟性
  - ブンデスリーガ: ハイプレス、速攻の特徴
  - 各リーグの特色ある戦術文化
- フォーメーションの相性を分析

### 3.3 出力機能

#### 3.3.1 試合結果表示
以下の情報を表示する：

1. **試合スコア**
   - 最終スコア（例: 3-2）
   - 前半スコア
   - 後半スコア

2. **前半/後半の流れ**
   - 各ハーフの展開説明
   - 主な戦術的変化

3. **主要な得点シーン**
   - ゴール時間
   - 得点者
   - アシスト者
   - 得点の経緯

4. **ハイライトシーン（2-3個）**
   - 重要なプレー
   - ターニングポイント
   - 決定的なシーン

5. **統計データ**
   - ポゼッション率（%）
   - シュート数
   - 枠内シュート数
   - コーナーキック数
   - ファウル数
   - イエローカード/レッドカード
   - その他関連統計

6. **試合環境情報**
   - 天候
   - 気温
   - ピッチ状態

### 3.4 オプション機能（将来拡張）
- フォーメーション図の視覚化
- 対戦履歴の保存
- 選手の試合中パフォーマンス評価

## 4. システム構成

### プロジェクト名
`soccer-match-simulator`

### 4.1 フロントエンド構成
```
src/
├── components/
│   ├── TeamInput.tsx          // チーム情報入力コンポーネント
│   ├── MatchResult.tsx        // 試合結果表示コンポーネント
│   ├── Formation.tsx          // フォーメーション図（将来拡張）
│   └── Statistics.tsx         // 統計データ表示
├── types/
│   ├── team.ts               // チーム型定義
│   ├── match.ts              // 試合結果型定義
│   └── player.ts             // 選手型定義
├── services/
│   └── api.ts                // API呼び出しサービス
└── App.tsx
```

### 4.2 バックエンド構成
```
lambda/
├── src/
│   ├── index.ts              // メインハンドラー
│   ├── geminiService.ts      // Gemini API連携
│   ├── matchSimulator.ts     // 試合シミュレーションロジック
│   └── types.ts              // 型定義
├── package.json
├── tsconfig.json
└── README.md
```

### 4.3 API仕様

#### エンドポイント
- **POST** `/simulate-match`

#### リクエストボディ
```json
{
  "homeTeam": {
    "name": "string",
    "manager": "string",
    "formation": "string",
    "players": [
      {
        "name": "string",
        "position": "string"
      }
    ]
  },
  "awayTeam": {
    "name": "string",
    "manager": "string",
    "formation": "string",
    "players": [
      {
        "name": "string",
        "position": "string"
      }
    ]
  }
}
```

#### レスポンスボディ
```json
{
  "score": {
    "home": "number",
    "away": "number",
    "halfTime": {
      "home": "number",
      "away": "number"
    }
  },
  "matchFlow": {
    "firstHalf": "string",
    "secondHalf": "string"
  },
  "goals": [
    {
      "minute": "number",
      "team": "string",
      "scorer": "string",
      "assist": "string",
      "description": "string"
    }
  ],
  "highlights": [
    {
      "minute": "number",
      "description": "string"
    }
  ],
  "statistics": {
    "possession": {
      "home": "number",
      "away": "number"
    },
    "shots": {
      "home": "number",
      "away": "number"
    },
    "shotsOnTarget": {
      "home": "number",
      "away": "number"
    },
    "corners": {
      "home": "number",
      "away": "number"
    },
    "fouls": {
      "home": "number",
      "away": "number"
    },
    "yellowCards": {
      "home": "number",
      "away": "number"
    },
    "redCards": {
      "home": "number",
      "away": "number"
    }
  },
  "weather": {
    "condition": "string",
    "temperature": "number",
    "pitchCondition": "string"
  }
}
```

## 5. Gemini APIプロンプト設計

### 5.1 プロンプト構成要素
- チーム情報（チーム名、監督、フォーメーション）
- 選手リスト（名前、ポジション）
- 天候・環境条件
- 求める出力形式（JSON）

### 5.2 プロンプト例
```
あなたはサッカー試合のシミュレーターです。
以下の2チームの試合をシミュレートしてください。

【ホームチーム】
チーム名: [チーム名]
監督: [監督名]
フォーメーション: [フォーメーション]
メンバー:
- GK: [選手名]
- DF: [選手名リスト]
- MF: [選手名リスト]
- FW: [選手名リスト]

【アウェイチーム】
（同様）

【重要な考慮事項】
1. **監督の特徴を詳細に反映**:
   - 各監督の戦術哲学、プレススタイル、攻撃パターン
   - 監督特有の選手起用法や試合運び
   - 監督の実績や特徴的な戦術

2. **2024-25シーズンの各リーグトレンドを考慮**:
   - 選手が所属するリーグの現在の戦術トレンド
   - プレミアリーグ: [現在のトレンド]
   - ラ・リーガ: [技術的、ポゼッション重視]
   - セリエA: [守備組織、戦術的柔軟性]
   - ブンデスリーガ: [ハイプレス、速攻]
   - リーグ特有の戦術文化を試合展開に反映

3. **シミュレーション条件**:
   - 天候、気温、ピッチ状態は、あなた（AI）がリアルな組み合わせでランダムに決定
   - 毎回異なる試合展開になるようにする
   - 実在選手の現在の能力・特徴、フォーメーションの相性、環境条件を考慮
   - 選手の調子やコンディションも加味（ランダム要素）

以下のJSON形式で結果を出力してください：
[JSONスキーマ]
```

## 6. UI/UXデザイン方針

### 6.0 参考サイト
- **SofaScore** (https://www.sofascore.com/)
  - 試合結果表示のレイアウト
  - 統計データの視覚化（ポゼッション率、シュート数など）
  - スコアボードのデザイン
  - レスポンシブデザイン
  - カラースキーム

### 6.1 画面構成
1. **入力画面**
   - 左右2カラムレイアウト（自チーム / 対戦相手）
   - フォーム入力
   - シミュレーション実行ボタン

2. **結果表示画面**
   - スコアボード（大きく表示）
   - タブまたはセクション分け
     - 試合の流れ
     - 得点シーン
     - ハイライト
     - 統計データ
   - 再シミュレーションボタン

### 6.2 デザイン要素
- サッカーをイメージしたカラースキーム（グリーン系）
- **SofaScoreスタイルの要素**:
  - クリーンでモダンなUI
  - 統計データのプログレスバー表示（ポゼッション率など）
  - スコアボードの大胆な数字表示
  - タイムライン形式での得点・イベント表示
  - カード風のコンポーネントデザイン
- レスポンシブデザイン（モバイル対応）
- ローディング表示（シミュレーション中）

## 7. 開発フェーズ

### Phase 1: MVP（最小実用版）
- [ ] フロントエンド基本UI作成
- [ ] チーム情報入力機能
- [ ] Lambda関数作成
- [ ] Gemini API連携
- [ ] 試合結果表示機能
- [ ] AWS デプロイ

### Phase 2: 機能拡張
- [ ] フォーメーション図の視覚化
- [ ] 対戦履歴保存機能
- [ ] UIデザイン改善
- [ ] エラーハンドリング強化

### Phase 3: 追加機能
- [ ] 選手交代シミュレーション
- [ ] 戦術変更機能
- [ ] より詳細な統計データ
- [ ] シェア機能

## 8. 注意事項

### 8.1 制約事項
- 選手名は実在するヨーロッパトップリーグの選手に限定
- AIの知識に基づくため、最新の選手情報は反映されない可能性がある
- シミュレーション結果はAIによる予測であり、実際の試合結果を保証するものではない

### 8.2 コスト管理
- Gemini API呼び出し回数の監視
- Lambda実行時間の最適化
- S3ストレージ使用量の管理

## 9. 今後の拡張可能性

- リーグ戦シミュレーション
- トーナメント形式の大会シミュレーション
- 過去の実際の試合データとの比較機能
- カスタムチーム作成（架空のドリームチーム）
- 選手育成要素の追加

---

**作成日**: 2025年11月15日  
**バージョン**: 1.0
